<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T.SHOP - Your Tech Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .header {
            background-color: white;
            padding: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo img {
            height: 40px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .search-bar button {
            background: none;
            border: none;
            margin-left: 10px;
            cursor: pointer;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .login-link {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }

        .login-link:hover {
            color: #F0C419;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        /* Navigation Styles */
        .main-nav {
            background-color: #222;
            padding: 15px 0;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #F0C419;
        }

        /* Hero Section */
        .hero {
            background-color: #F0C419;
            padding: 60px 0;
            color: white;
        }

        .hero-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 40px;
        }

        .hero-text {
            flex: 1;
        }

        .hero-text p {
            font-size: 18px;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
        }

        .hero-image {
            flex: 1;
            text-align: center;
        }

        .hero-image img {
            max-width: 100%;
            height: auto;
        }

        /* Filter Section Styles */
        .filters {
            background: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filters-grid {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            color: #333;
            background-color: white;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #F0C419;
        }

        /* Products Section */
        .products {
            padding: 40px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .section-header h2 {
            font-size: 24px;
            color: #333;
        }

        .see-more {
            color: black;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .see-more:hover {
            color: #d4a800;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
        }

        /* Footer Styles */
        .footer {
            background: #222;
            color: white;
            padding: 40px 0 20px;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: white;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column a {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column a:hover {
            color: #F0C419;
        }

        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .social-icons {
            display: flex;
            gap: 15px;
        }

        .social-link {
            color: white;
            font-size: 20px;
            transition: color 0.3s;
            text-decoration: none;
        }

        .facebook-icon::before {
            content: "\f09a";
            font-family: "Font Awesome 6 Brands";
        }

        .twitter-icon::before {
            content: "\f099";
            font-family: "Font Awesome 6 Brands";
        }

        .instagram-icon::before {
            content: "\f16d";
            font-family: "Font Awesome 6 Brands";
        }

        .social-link:hover {
            color: #F0C419;
        }

        .search-icon::before {
            content: "\f002";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
        }

        .menu-icon::before {
            content: "\f0c9";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .search-bar {
                display: none;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: #222;
                padding: 20px;
                flex-direction: column;
                gap: 15px;
                z-index: 1000;
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links li {
                width: 100%;
            }

            .nav-links a {
                display: block;
                padding: 10px 0;
            }

            .hero-content {
                flex-direction: column;
                text-align: center;
            }

            .hero-text p {
                margin: 0 auto;
            }

            .filters-grid {
                flex-direction: column;
                gap: 15px;
            }

            .filter-group {
                width: 100%;
            }

            .footer-bottom {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }

        /* Error Messages */
        .error-message {
            color: #dc3545;
            text-align: center;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Add these styles at the beginning of your existing styles */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #F0C419;
            color: white;
            padding: 8px;
            z-index: 100;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 0;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Product Card Styles */
        .product-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .product-card h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #333;
        }

        .product-card .price {
            font-size: 18px;
            font-weight: bold;
            color: #F0C419;
            margin-bottom: 5px;
        }

        .product-card .brand {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .product-card .compare-btn {
            width: 100%;
            padding: 8px;
            background-color: #F0C419;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .product-card .compare-btn:hover {
            background-color: #d4a800;
        }

        .add-to-cart-btn {
            width: 100%;
            padding: 8px;
            background-color: #F0C419;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-to-cart-btn:hover {
            background-color: #d4a800;
        }

        .add-to-cart-btn i {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- Skip to main content link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <div class="logo">
                <a href="index.html" aria-label="T.SHOP Home">
                    <img src="t.shop logo.png" alt="T.SHOP Logo">
                </a>
            </div>
            <div class="search-bar" role="search">
                <input type="text" placeholder="Search products..." aria-label="Search products">
                <button type="button" aria-label="Search">
                    <i class="search-icon"></i>
                </button>
            </div>
            <div class="header-right">
                <a href="login.html" class="login-link" aria-label="Login to your account">Login</a>
                <button class="mobile-menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false">
                    <i class="menu-icon"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav" role="navigation" aria-label="Main navigation">
        <div class="container">
            <ul class="nav-links">
                <li><a href="index.html" aria-current="page">Home</a></li>
                <li><a href="cart.html">Cart</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main content -->
    <main id="main-content" role="main">
        <!-- Hero Section -->
        <section class="hero" aria-labelledby="hero-heading">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <h1 id="hero-heading" class="visually-hidden">Welcome to T.SHOP</h1>
                        <p>Welcome to T.SHOP, your go-to price comparison platform designed to make shopping easier, smarter, and more affordable.</p>
                    </div>
                    <div class="hero-image">
                        <img src="large_logo.png" alt="T.SHOP large logo">
                    </div>
                </div>
            </div>
        </section>

        <!-- Filter Section -->
        <section class="filters">
            <div class="container">
                <div class="filters-grid">
                    <div class="filter-group">
                        <select id="category-filter" class="filter-select" aria-label="Select product category">
                            <option value="">Category</option>
                            <option value="mobile">Mobile Phones</option>
                            <option value="tv">TV</option>
                            <option value="laptop">Laptop</option>
                            <option value="camera">Camera</option>
                            <option value="headphones">Headphones</option>
                            <option value="watch">Watch</option>
                            <option value="robot-vacuum">Robot Vacuums</option>
                            <option value="tablet">Tablet</option>
                            <option value="keyboard">Keyboard</option>
                            <option value="projector">Projector</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <select id="brand-filter" class="filter-select" aria-label="Select product brand">
                            <option value="">Brand</option>
                            <option value="apple">Apple</option>
                            <option value="samsung">Samsung</option>
                            <option value="dyson">Dyson</option>
                            <option value="sony">Sony</option>
                            <option value="lg">LG</option>
                            <option value="panasonic">Panasonic</option>
                            <option value="others">Others</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <select id="budget-filter" class="filter-select" aria-label="Select price range">
                            <option value="">Budget</option>
                            <option value="1-5">1-5k</option>
                            <option value="5-10">5-10k</option>
                            <option value="10-20">10-20k</option>
                            <option value="20-30">20-30k</option>
                            <option value="30-40">30-40k</option>
                            <option value="40-50">40-50k</option>
                            <option value="50-80">50-80k</option>
                            <option value="80-100">80-100k</option>
                            <option value="100-150">100-150k</option>
                            <option value="150-200">150-200k</option>
                            <option value="200+">Above 200k</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <select id="retailer-filter" class="filter-select" aria-label="Select retailer">
                            <option value="">Retailer</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <select id="condition-filter" class="filter-select" aria-label="Select product condition">
                            <option value="">Status</option>
                            <option value="new">New</option>
                            <option value="used">Used</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Categories -->
        <section class="products">
            <div class="container">
                <div class="section-header">
                    <h2>Featured Products</h2>
                </div>
                <div class="product-grid">
                    <!-- Products will be dynamically inserted here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3>Company</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="copyright">
                    © 2025 T.SHOP. All rights reserved.
                </div>
                <div class="social-icons">
                    <a href="#" class="social-link facebook">
                        <i class="facebook-icon"></i>
                    </a>
                    <a href="#" class="social-link twitter">
                        <i class="twitter-icon"></i>
                    </a>
                    <a href="#" class="social-link instagram">
                        <i class="instagram-icon"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script type="module">
        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";
        import { getFirestore, collection, getDocs, query, where, doc, getDoc, addDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

        //  web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA98IdrETQBUz-Bmkusx0-dfoYSQZcb4y0",
            authDomain: "project2-46d53.firebaseapp.com",
            projectId: "project2-46d53",
            storageBucket: "project2-46d53.appspot.com",
            messagingSenderId: "547659515711", // An ID used for Firebase Cloud Messaging (FCM) — useful for sending push notifications.
            appId: "1:547659515711:web:4f2aff7809406def61358a",
            measurementId: "G-XBSG9VGDNG"
        };

        // Initialize Firebase
        try {
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            // Make Firebase functions available globally
            window.db = db;
            window.auth = auth;
            window.getAuth = getAuth;
            window.collection = collection;
            window.getDocs = getDocs;
            window.query = query;
            window.where = where;
            window.doc = doc;
            window.getDoc = getDoc;
            window.addDoc = addDoc;
            window.updateDoc = updateDoc;
            window.increment = increment;
            
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Error initializing Firebase:', error);
        }
    </script>

   
    <script>
        
        window.addEventListener('load', async () => {
            
            if (!window.db || !window.auth) {
                console.error('Firebase not initialized');
                return;
            }

            // Get all filter select elements
            const categoryFilter = document.getElementById('category-filter');
            const brandFilter = document.getElementById('brand-filter');
            const budgetFilter = document.getElementById('budget-filter');
            const retailerFilter = document.getElementById('retailer-filter');
            const conditionFilter = document.getElementById('condition-filter');
            const productGrid = document.querySelector('.product-grid');
            const searchInput = document.querySelector('.search-bar input');
            const searchButton = document.querySelector('.search-bar button');

            // Function to handle search
            function handleSearch(shouldScroll = false) {
                const searchTerm = searchInput.value.toLowerCase().trim();
                const productCards = document.querySelectorAll('.product-card');    //methods that returns anodelist of all elements
                let hasResults = false;
//hasResults is a flag used to determine whether any visible product matches the search term.
                productCards.forEach(card => {
                    const productName = card.querySelector('h3').textContent.toLowerCase();
                    const productBrand = card.querySelector('.brand').textContent.toLowerCase();
                    
                    //  if search term matches product name or brand
                    const matchesSearch = productName.includes(searchTerm) || productBrand.includes(searchTerm);
                    card.style.display = matchesSearch ? 'block' : 'none';
                    if (matchesSearch) hasResults = true;
                });

                // Scroll to products section only if shouldScroll is true and there are results
                if (shouldScroll && hasResults) {
                    const productsSection = document.querySelector('.products');
                    productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); //method that scrolls page to the element
                }
            }

            // Add event listeners for search, ways to trigger search
            searchInput.addEventListener('input', () => handleSearch(false));
            searchButton.addEventListener('click', () => handleSearch(true));
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearch(true);
                }
            });

            // Function to load retailers (users with usertype=retailer)
            async function loadRetailers() {
                try {
                    const usersRef = collection(db, 'users');
                    const q = query(usersRef, where('userType', '==', 'retailer'));
                    const snapshot = await getDocs(q);
                    
                    // Clear existing options except the default one
                    retailerFilter.innerHTML = '<option value="">Retailer</option>';
                    
                    // Add retailers to dropdown
                    snapshot.forEach(doc => {
                        const retailer = doc.data();  //retrieves actual data from the document
                        const option = document.createElement('option');
                        option.value = doc.id;
                        option.textContent = retailer.username || retailer.email;
                        retailerFilter.appendChild(option);  //adds the new option to the dropdown
                    });
                } catch (error) {
                    console.error('Error loading retailers:', error);
                }
            }

            // Function to create a product card
            function createProductCard(product) {   //multi line string, ${ ... } used to insert dynamic values
                return `                                 
                    <div class="product-card" 
                        data-category="${product.category || ''}" 
                        data-brand="${product.brand || ''}" 
                        data-price="${product.price || 0}" 
                        data-retailer="${product.retailerId || ''}" 
                        data-status="${product.status || ''}">
                        <img src="${product.imageUrl || 'placeholder.jpg'}" alt="${product.name || 'Product'}">
                        <h3>${product.name || 'Unnamed Product'}</h3>
                        <p class="price">KSH ${(product.price || 0).toLocaleString()}</p>
                        <p class="brand">${product.brand || 'Unknown Brand'}</p>
                        <button class="add-to-cart-btn" onclick="addToCart('${product.id}')">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                    </div>
                `;
            }

            // Function to filter products
            function filterProducts() {
                const selectedCategory = categoryFilter.value;
                const selectedBrand = brandFilter.value;
                const selectedBudget = budgetFilter.value;
                const selectedRetailer = retailerFilter.value;
                const selectedStatus = conditionFilter.value;

                // Get all product cards
                const productCards = document.querySelectorAll('.product-card');

                productCards.forEach(card => {             //card rep the current product card in the loop
                    const category = card.dataset.category;           //access data attributes
                    const brand = card.dataset.brand;
                    const price = parseFloat(card.dataset.price);
                    const retailer = card.dataset.retailer;
                    const status = card.dataset.status;

                    // Budget range filtering
                    let priceInRange = true;
                    if (selectedBudget) {
                        const [min, max] = selectedBudget.split('-').map(Number);
                        const minPrice = min * 1000;
                        const maxPrice = max ? max * 1000 : Infinity;
                        priceInRange = price >= minPrice && price <= maxPrice;
                    }

                    // Show/hide card based on all filter criteria
                    const shouldShow = 
                        (!selectedCategory || category === selectedCategory) &&
                        (!selectedBrand || brand === selectedBrand) &&
                        (!selectedBudget || priceInRange) &&
                        (!selectedRetailer || retailer === selectedRetailer) &&
                        (!selectedStatus || status === selectedStatus);

                    card.style.display = shouldShow ? 'block' : 'none';
                });
            }

            // Add event listeners to all filters
            [categoryFilter, brandFilter, budgetFilter, retailerFilter, conditionFilter].forEach(filter => {
                filter.addEventListener('change', filterProducts);
            });

            // Function to fetch and display products from Firestore
            async function loadProducts() {
                try {
                    const productsRef = collection(db, 'products');
                    const snapshot = await getDocs(productsRef);
                    
                    productGrid.innerHTML = ''; // Clear existing products
                    
                    if (snapshot.empty) {
                        productGrid.innerHTML = '<p class="error-message">No products found.</p>';
                        return;
                    }

                    // Create a map to store retailer names
                    const retailerNames = new Map();
                    const usersRef = collection(db, 'users');
                    const q = query(usersRef, where('userType', '==', 'retailer'));
                    const retailersSnapshot = await getDocs(q);
                    
                    retailersSnapshot.forEach(doc => {
                        const retailer = doc.data();
                        retailerNames.set(doc.id, retailer.username || retailer.email);
                    });
                    
                    snapshot.forEach(doc => {
                        const productData = doc.data();
                        const product = {
                            id: doc.id,
                            ...productData,
                            retailerName: retailerNames.get(productData.retailerId) || 'Unknown Retailer'
                        };
                        productGrid.innerHTML += createProductCard(product);
                    });

                    // Initialize filters after products are loaded
                    filterProducts();
                } catch (error) {
                    console.error('Error loading products:', error);
                    productGrid.innerHTML = '<p class="error-message">Error loading products. Please try again later.</p>';
                }
            }

            // Function to handle adding items to cart
            window.addToCart = async function(productId) {
                try {
                    const user = auth.currentUser;   
                   //property that returns the currently signed-in user's information, if someone is logged in. 
                    if (!user) {
                        window.location.href = 'login.html';
                        return;
                    }

                    const productRef = doc(db, 'products', productId);
                    const productSnap = await getDoc(productRef);
                    
                    if (!productSnap.exists()) {
                        return;
                    }

                    const product = productSnap.data();

                    const cartRef = collection(db, 'carts');
                    const cartQuery = query(cartRef, 
                        where('userId', '==', user.uid),
                        where('productId', '==', productId)
                    );
                    
                    const cartSnap = await getDocs(cartQuery);
                    
                    if (cartSnap.empty) {
                        const cartItem = {
                            userId: user.uid,
                            productId: productId,
                            quantity: 1,
                            addedAt: new Date(),
                            productName: product.name,
                            price: product.price,
                            imageUrl: product.imageUrl,
                            brand: product.brand
                        };
                        
                        await addDoc(cartRef, cartItem);
                    } else {
                        const cartDoc = cartSnap.docs[0];
                        await updateDoc(doc(cartRef, cartDoc.id), {
                            quantity: increment(1)
                        });
                    }

                    window.location.href = 'cart.html';
                    
                } catch (error) {
                    console.error('Error adding to cart:', error);
                    alert('Error adding product to cart. Please try again.');
                }
            }

            // Load products and retailers
            await loadProducts();
            await loadRetailers();
        });
    </script>
</body>
</html>
